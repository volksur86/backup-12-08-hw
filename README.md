Домашнее задание к занятию «Резервное копирование баз данных» Волкивский Андрей

Задание 1. Резервное копирование
Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

Приведите ответ в свободной форме.

Решение 1:

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день:

Для восстановление данных в полном объёме за предыдущий день, подходит классическое полное резервное копирование, выполняемое ежедневно. Как правило это мероприятие планируют в ночное время, когда система минимально нагружена. Это позволит восстановить базу данных в состоянии на конец предыдущего дня. Так же нужно отметить, что при таком восстановлении мы теряем данные которые были наработаны в течение настоящего рабочего дня, что для финансовой компании недопустимо, поэтому для минимизации потерь данных дополнительно можно комбинировать инкрементальные или дифференциальные бэкапы. Хотя если принимать задачу буквально, то в данном случае достаточно полного бэкапа за день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки:

Для такого восстановления требуется более частое резервное копирование, например, с использованием журналов транзакций или инкрементальные бэкапы с фиксированными временными метками.

1.3. Моментальное переключение при поломке на работающую базу данных:

Да, моментальное переключение возможно и широко используется в том числе и в финансовых компаниях. Такой кейс называется отказоустойчивостью и реализуется с помощью синхронной репликации и автоматического переключения (кластеры). Идея репликации основана на том, что кроме master-сервера постоянно работают slave-сервера, которые получают инкрементные бэкапы с master-сервера в режиме реального времени. Если master-сервер выходит из строя, один из slave-серверов может быстро взять на себя его роль (стать новым мастером), минимизируя простой приложений. Т.е. один из slave-серверов в режиме синхронной репликации имеет абсолютно идентичные данные на момент сбоя, а система мониторинга после обнаружения сбоя, автоматически повышает резервный узел Мастера и перенаправляет клиентов.

Задание 2. PostgreSQL
2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Приведите ответ в свободной форме.

Задание 2:

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

Команды резервного копирования и восстановления базы данных из официальной документации PostgreSQL:

Резервное копирование с помощью pg_dump (создание дампа базы данных в формате SQL-скрипта)

pg_dump -U username -d dbname -F c -f dbname_backup.dump

Где:

-U username — имя пользователя базы данных

-d dbname — имя базы данных

-F c — формат дампа (custom, что удобно для восстановления)

-f dbname_backup.dump — файл для сохранения резервной копии

Восстановление базы из созданного дампа с помощью pg_restore:

pg_restore -U username -d dbname -c dbname_backup.dump

Тут:

-d dbname — база, куда восстанавливаем

-c — опция для удаления объектов перед восстановлением (clean)

dbname_backup.dump — файл резервной копии

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

Да, процесс резервного копирования и восстановления можно автоматизировать с помощью bash-скриптов, выполнением которых можно управлять по расписанию через планировщик задач - cron, если мы настраиваем это в Linux.

Таким образом, PostgreSQL предоставляет встроенные утилиты pg_dump и pg_restore для резервного копирования и восстановления, а автоматизировать эти процессы можно через скрипты и планировщики задач с работающей базой команд для выполнения этих утилит.

Задание 3. MySQL
3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

Приведите ответ в свободной форме.

Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.

Решение 3:

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL

Пример команды инкрементного резервного копирования MySQL из официальной документации и других источников по этой теме: 

Для инкрементного бэкапа в MySQL обычно используют бинарные логи (binary logs), которые фиксируют все изменения в базе с момента последнего бэкапа. 

Вначалае приведу пример с утилитой mysqlbackup:

mysqlbackup --defaults-file=/home/dbadmin/my.cnf --incremental --incremental-base=history:last_backup --backup-dir=/home/dbadmin/inc_backup --backup-image=inc_backup.bi backup-to-image

Где:

--incremental — выполнение инкрементного бэкапа

--incremental-base=history:last_backup — база для инкрементов − последний успешный бэкап из истории

--backup-dir и --backup-image — место и имя файла для бэкапа

Или команда для инкрементного бэкапа с mysqlbinlog (на основе бинарных логов):

mysqlbinlog --start-datetime='2025-11-14 00:00:00' --stop-datetime='2025-11-14 23:59:59' --start-position=XXXX mysql-bin.000001 > incr_backup_2025-11-14.sql

Здесь указываем временные рамки и позиции после последнего полного бэкапа для создания инкрементного дампа.




